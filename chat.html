<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>the vegetables</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

  <header>
  <span class="settings-btn" onclick="document.getElementById('bgInput').click()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ©">
    <i class="fas fa-cog"></i>
  </span>
  ğŸ’¬ Ø£Ù‡Ù„Ø§Ù‹ <span id="userDisplay"></span>
  <span class="exit-btn" onclick="logout()" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬">
    <i class="fas fa-sign-out-alt"></i>
  </span>
  <input type="file" id="bgInput" accept="image/*" hidden>
</header>

  <div id="updatePopup" class="popup-overlay">
  <div class="popup-box">
    <h3>âœ¨ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«:</h3>
    <ul>
      <li>ğŸ“Œ Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙØ§Ø¹Ù„</li>
      <li>â†©ï¸ Ø§Ø³Ø­Ø¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙ‡Ø§</li>
      <li>ğŸ¨ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ù† Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</li>
    </ul>
    <button onclick="closePopup()">Ø­Ø³Ù†Ù‹Ø§</button>
  </div>
</div>

  <div id="typingIndicator" style="color: #888; font-size: 14px; margin: 5px 10px;"></div>


  <div id="chat-box"></div>

  <div class="chat-controls">
    <div class="media-menu-wrapper">
      <button class="media-btn" onclick="toggleMediaMenu()" title="Ø¥Ø±Ø³Ø§Ù„ Ù…ÙŠØ¯ÙŠØ§">
        <i class="fas fa-paperclip"></i>
      </button>
      <div class="media-menu" id="mediaMenu">
        <label onclick="uploadSpecificMedia('image/*')"><i class="fas fa-image"></i> ØµÙˆØ±Ø©</label>
        <label onclick="uploadSpecificMedia('video/*')"><i class="fas fa-video"></i> ÙÙŠØ¯ÙŠÙˆ</label>
        <label onclick="uploadSpecificMedia('*')"><i class="fas fa-file-alt"></i> Ù…Ù„Ù</label>
      </div>
    </div>
    <input type="file" id="mediaInput" hidden>
    <input type="text" id="message-input" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
    <button onclick="sendMessage()" title="Ø¥Ø±Ø³Ø§Ù„"><i class="fas fa-paper-plane"></i></button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase-config.js"></script>
  <script src="chat.js"></script>

  <script>
    function logout() {
      if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
        localStorage.removeItem("username");
        window.location.href = "index.html";
      }
    }
  </script>
  <script>
  function logout() {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) {
      localStorage.removeItem("username");
      window.location.href = "index.html";
    }
  }

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
  window.addEventListener("DOMContentLoaded", () => {
    const savedBg = localStorage.getItem("chatBackground");
    if (savedBg) {
      document.getElementById("chat-box").style.backgroundImage = `url(${savedBg})`;
      document.getElementById("chat-box").style.backgroundSize = "cover";
      document.getElementById("chat-box").style.backgroundPosition = "center";
    }
  });

  // ØªØºÙŠÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©
  document.getElementById("bgInput").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
      const imageData = e.target.result;
      document.getElementById("chat-box").style.backgroundImage = `url(${imageData})`;
      document.getElementById("chat-box").style.backgroundSize = "cover";
      document.getElementById("chat-box").style.backgroundPosition = "center";
      localStorage.setItem("chatBackground", imageData);
    };
    reader.readAsDataURL(file);
  });
</script>
<script> 
window.addEventListener("DOMContentLoaded", () => {
  const seenUpdate = localStorage.getItem("seenUpdate_1");
  if (!seenUpdate) {
    document.getElementById("updatePopup").style.display = "flex";
  }
});

function closePopup() {
  document.getElementById("updatePopup").style.display = "none";
  localStorage.setItem("seenUpdate_1", "true");
}

</script>
  <script>
const typingIndicator = document.getElementById("typingIndicator");

db.ref("typing").on("value", snapshot => {
  const data = snapshot.val();
  if (!data) {
    typingIndicator.textContent = '';
    return;
  }

  const typingUsers = Object.keys(data).filter(name => name !== username);

  if (typingUsers.length > 0) {
    typingIndicator.textContent = `${typingUsers.join(", ")} ÙŠÙƒØªØ¨...`;
  } else {
    typingIndicator.textContent = '';
  }
});

</script>
</body>
</html>
